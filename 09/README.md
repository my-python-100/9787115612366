# 第 9 章 装饰器和闭包

## 9.2 装饰器基础知识

* 是一种可调用对象，其参数是另一个函数

## 9.3 Python 何时执行装饰器

* 在被装饰的函数定义之后立即运行，这通常是在导入时

## 9.4　注册装饰器

* 装饰器通常在一个模块中定义，然后再应用到其他模块中的函数 上
* 大多数装饰器会在内部定义一个函数，然后将其返回

## 9.5　变量作用域规则

* Python 不要求声明变量，但是会假 定在函数主体中赋值的变量是局部变量

* 在函数中赋值时，如果想让解释器把 b 当成全局变量，为它分配一个 新值，就要使用 global 声明

## 9.6　闭包

* 只有涉及嵌套函数时才有闭包问题
* 闭包就是延伸了作用域的函数， 是它能访问主体之外定义的非全局变量
* 自由变量是指**未在局部作用域中绑定的变量**

```python
__code__.co_varnames
__code__.co_freevars

# cell 对象有一个名为 cell_contents的属性，保存着真正的值
__closure__[0].cell_contents
```
* 闭包是一个函数，它保留了定义函数时存在的自由变量的绑定


## 9.7　nonlocal 声明

```python
# 因此，实际上我们在 averager 的 主体中为 count 赋值了，这会把 count 变成局部变量
count += 1
count = count + 1
```

* Python 3 引入了 nonlocal 关键字。它的作用 是把变量标记为自由变量

**变量查找逻辑**
